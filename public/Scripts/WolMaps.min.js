function btnDisable(){$("#interative-map-email-address").val()==""&&$("#interative-map-phone-number").val()==""&&$(".interactive-notify-button").prop("disabled",!0)}function getQueryStringForSearch(n,t){t||(t=window.location.href);n=n.replace(/[\[\]]/g,"\\$&");var r=new RegExp("[?&]"+n+"(=([^&#]*)|&|#|$)"),i=r.exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null}function outageMapCallBack(){submitOutageNotify()}function submitOutageNotify(){var n={Email:$("#interative-map-email-address").val(),PhoneNumber:$("#interative-map-phone-number").val().replace(/[^a-z0-9\s]/gi,"").replace(/[_\s]/g,"-").replace(/-/g,""),OutageId:$("#deviceId").val()};$.ajax({type:"POST",url:"/api/sitecore/OutageMap/OutageNotification",contentType:"application/json; charset=utf-8",data:JSON.stringify(n),dataType:"json",success:function(n){n.Success==!0?($(".modal").modal("hide"),$("body .modal-backdrop.in").remove(),_infowindow.close(),n.IsAuthenticated==!1&&($("#interactiveMapNotify .form-group label").removeClass("is-text"),$("#interative-map-email-address").val(""),$("#interative-map-phone-number").val(""),btnDisable())):n.Success==!1},error:function(){alert("error")}})}var _infowindow,mapViewFlag,captcha_validation;$(function(){function ii(){function ii(n,t,i){n.geocode({address:pt},function(n,r){if(r==="OK"){t.setCenter(n[0].geometry.location);var u=new google.maps.Marker({map:t,position:n[0].geometry.location,icon:i})}else alert("Geocode was not successful for the following reason: "+r)})}for(n=function(){return p=null,$.ajax({async:!1,global:!1,url:Url,dataType:"json",success:function(n){p=n}}),p}(),r=new google.maps.Map(document.getElementById("map"),{center:{lat:47.6,lng:-122.167},zoom:7,mapTypeId:google.maps.MapTypeId.ROADMAP,fullscreenControlOptions:{position:google.maps.ControlPosition.TOP_LEFT},zoomControl:!0,zoomControlOptions:{position:google.maps.ControlPosition.TOP_RIGHT}}),$(window).width()<=991&&r.setOptions({zoomControl:!1,mapTypeControl:!1}),_infowindow=new google.maps.InfoWindow({disableAutoPan:!1}),w=[],b=[],u=[],dt=[],k=[],it=[],n.PseMap.forEach(function(i,e){var o,s;for(t=n.PseMap[e],ut={lat:parseFloat(t.DataProvider.PointOfInterest.Latitude),lng:parseFloat(t.DataProvider.PointOfInterest.Longitude)},f="",v=t.DataProvider.Attributes,h=0,st=v.length;h<st;h++)f+="<li><span>"+v[h].Name+": <\/span><span>"+v[h].Value+"<\/span><\/li>";t.DataProvider.PointOfInterest.PlannedOutage==!1?tt='<div class="add-notify"><a href="#" data-toggle="modal" data-target=".map-notification-modal"><span>'+NotifyAboutText+'<\/span > <i class="fa fa-chevron-right"><\/i><\/a > <\/div>':(tt="",$(".gm-style-iw").css("top","15px !important"));ot='<div id="bodyContent">\t<div class="description"><h6>'+t.DataProvider.PointOfInterest.Title+" <\/h6><ul>"+f+"\t\t<\/ul> <\/div>"+tt+"<\/div>";kt='<div class="col-xs-12 col-sm-6 col-md-4" id="mapListData">\t<span class="listView-title">'+(e+1)+". "+t.DataProvider.PointOfInterest.Title+" <\/span><ul>"+f+"\t\t<\/ul> <\/div>";k.push(t.DataProvider.PointOfInterest.Title+"<\/span><ul>"+f+"\t\t<\/ul> <\/div>");f="";w.push(ut);b.push(ot);u.push(t.Polygon);it.push(t.DataProvider.PointOfInterest.Id);ti=="true"&&typeof t.BoundingBox!==undefined&&t.BoundingBox!==null&&(o=new google.maps.Rectangle({bounds:new google.maps.LatLngBounds(new google.maps.LatLng(parseFloat(t.BoundingBox.Min.Latitude),parseFloat(t.BoundingBox.Min.Longitude)),new google.maps.LatLng(parseFloat(t.BoundingBox.Max.Latitude),parseFloat(t.BoundingBox.Max.Longitude))),map:r,fillOpacity:.2,strokeOpacity:.5,strokeWeight:1}));s=new google.maps.LatLng(parseFloat(t.DataProvider.PointOfInterest.Latitude),parseFloat(t.DataProvider.PointOfInterest.Longitude));$("#interactiveMapNotify #deviceId").val(t.DataProvider.PointOfInterest.Id)}),o=w.map(function(n,t){var i=new google.maps.Marker({position:n,icon:wt});return i.getCorrespondingContent=function(){return k[t]},google.maps.event.addListener(i,"click",function(){var f,e,u;_infowindow.setContent(b[t]);_infowindow.open(r,i);r.panTo(n);f=$(".gm-style-iw");e=f.prev();e.children(":nth-child(2)").css({display:"none"});e.children(":nth-child(4)").css({display:"none"});u=f.next();u.css({opacity:"1",right:"70px",top:"28px",cursor:"pointer"});$(window).width()<=991&&u.css({right:"55px",top:"90px"});u.click(function(){_infowindow.close()});$(".add-notify").on("click",function(){_infowindow.close()});$(document).on("click",".notify-btn .back",function(){google.maps.event.trigger(i,"click")});$("#deviceId").val(it[t])}),i}),ft=new google.maps.Polygon({strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:2,fillColor:"#FF0000",fillOpacity:.35}),l=[],a=[],i=0;i<u.length;i++)if(typeof u!==undefined&&u!==null&&u[i]!=null){for(et=u[i].length,s=0;s<et;s++)l.push(new google.maps.LatLng(parseFloat(u[i][s].Latitude),parseFloat(u[i][s].Longitude)));a.push(l);l=[]}for(c=0;c<a.length;c++)d=new google.maps.Polygon(ft),d.setPaths(a[c]),d.setMap(r);ht={styles:[{textColor:"white",height:32,url:e,width:32},{textColor:"white",height:32,url:e,width:32},{textColor:"white",height:32,url:e,width:32},{textColor:"white",height:32,url:e,width:32},{textColor:"white",height:32,url:e,width:32}]};var ri=new MarkerClusterer(r,o,ht);if(google.maps.event.addDomListener(window,"load"),typeof n.Common!==undefined&&n.Common!==null&&(typeof n.Common.OutageCount!==undefined&&n.Common.OutageCount!==null&&$(gt).html(n.Common.OutageCount),typeof n.Common.CustomerAfftectedCount!==undefined&&n.Common.CustomerAfftectedCount!==null&&$(ni).html(n.Common.CustomerAfftectedCount)),"CustomerProfile"in n&&typeof n.CustomerProfile!==undefined&&n.CustomerProfile!==null){for(i=0;i<n.CustomerProfile.MyAddress.length;i++)y=rt,y=n.CustomerProfile.MyAddress[i].Status=="Red"?bt:rt,ct=n.CustomerProfile.MyAddress[i].Address1,lt=n.CustomerProfile.MyAddress[i].Address2,at=n.CustomerProfile.MyAddress[i].City,yt=n.CustomerProfile.MyAddress[i].State,vt=n.CustomerProfile.MyAddress[i].Zipcode,pt=[ct,lt,at,yt,vt].filter(Boolean).join(", "),_locationId=n.CustomerProfile.MyAddress[i].DeviceLocationId,ii(nt,r,y);typeof n.CustomerProfile.Contact!==undefined&&n.CustomerProfile.Contact!==null&&(typeof n.CustomerProfile.Contact.EmailAddress!==undefined&&n.CustomerProfile.Contact.EmailAddress!==null&&($("#interative-map-email-address").siblings("label").addClass("is-text"),$("#interative-map-email-address").val(n.CustomerProfile.Contact.EmailAddress)),typeof n.CustomerProfile.Contact.PhoneNumber!==undefined&&n.CustomerProfile.Contact.PhoneNumber!==null&&($("#interative-map-phone-number").siblings("label").addClass("is-text"),$("#interative-map-phone-number").val(n.CustomerProfile.Contact.PhoneNumber)))}google.maps.event.addListener(r,"bounds_changed",function(){var n;$(r.getDiv()).children().eq(0).height()==window.innerHeight&&$(r.getDiv()).children().eq(0).width()==window.innerWidth&&(n=$(".map-notification-modal").clone()[0],$(".map-notification-modal").remove(),$("#map>div").find(".map-notification-modal").length||$("#map>div").append(n),$("#interative-map-phone-number").inputmask({mask:"(999) 999-9999"}),$("#interactiveMapNotify").validate({ignore:".ignore",hiddenRecaptcha:{required:!0},messages:{hiddenRecaptcha:{required:captcha_validation.captchaFormNotArobot}},errorPlacement:function(n,t){n.appendTo(t.parent(".errorDiv").next(".errorMessage"))}}),$("#interative-map-email-address").rules("add",{mail:!0,messages:{required:NotifyMeValidation.verifiedaddressemail}}),$("#interative-map-phone-number").rules("add",{phoneUSA:!0,messages:{required:NotifyMeValidation.verifiedmobileno}}))});google.maps.event.addListener(r,"idle",function(){var t="",i=1,n;for(g.empty(),n=0;n<o.length;n++)r.getBounds().contains(o[n].getPosition())&&(t+='<div class="col-xs-12 col-sm-6 col-md-4 listView-container"><span class="listView-title">'+i+++". "+o[n].getCorrespondingContent()+"<\/div>");g[0].innerHTML=t;$("#OutageListTable .listView-container").length>9?($(".controls").show(),ui()):$(".controls").hide()})}function ri(n,t,i){function u(n,t){return Array.from(Array(t-n+1),function(t,i){return i+n})}if(i<5)throw"maxLength must be at least 5";var r=i<9?1:2,e=i-r*2-3>>1,f=i-r*2-2>>1;return n<=i?u(1,n):t<=i-r-1-f?u(1,i-r-1).concat([0]).concat(u(n-r+1,n)):t>=n-r-1-f?u(1,r).concat([0]).concat(u(n-r-1-f-e,n)):u(1,r).concat([0]).concat(u(t-e,t+f)).concat([0]).concat(u(n-r+1,n))}function ui(){function t(t){return t<1||t>r?!1:(n=t,$("#OutageListTable .listView-container").hide().slice((n-1)*i,n*i).show(),$(".controls span").slice(1,-1).remove(),ri(r,n,f).forEach(function(t){$("<span>").addClass("page-item pnumbers").addClass(t?"current-page":"disabled").toggleClass("active",t===n).append($("<a>").addClass("page-link").attr({href:"javascript:void(0)"}).text(t||"...")).insertBefore("#next-page")}),$("#previous-page").toggleClass("disabled",n===1),$("#next-page").toggleClass("disabled",n===r),!0)}var u=$("#OutageListTable .listView-container").length,i=9,r=Math.ceil(u/i),f=9,n;$(".controls").append($("<span>").addClass("page-item").attr({id:"previous-page"}).append($("<a>").addClass("page-link").attr({href:"javascript:void(0)"}).append($("<i>").addClass("fa fa-chevron-left"))),$("<span>").addClass("page-item").attr({id:"next-page"}).append($("<a>").addClass("page-link").attr({href:"javascript:void(0)"}).append($("<i>").addClass("fa fa-chevron-right"))));$("#OutageListTable").show();t(1);$(document).on("click",".controls span.current-page:not(.active)",function(){return t(+$(this).text())});$("#next-page").on("click",function(){return t(n+1)});$("#previous-page").on("click",function(){return t(n-1)})}function fi(n,t){var i=document.getElementById("pse-search-txt").value;i=$.trim(i);i.length>0&&n.geocode({address:i+", WA, USA"},function(n,i){i==="OK"?(t.setCenter(n[0].geometry.location),r.setZoom(11)):console.log("Geocode was not successful for the following reason: "+i)})}var wt=RedImage,e=PolyImage,rt=HomeGreenImage,bt=HomeOrangeImage,n,p,r,o,i,c,s,h,w,b,k,u,t,ut,ft,l,et,a,d,kt,dt,v,ot,f,st,g,ht,nt,ct,lt,at,vt,yt,pt,y,tt,it,gt="#outage-total-count",ni="#customer-affect-total",ti="false";g=$("#OutageListTable");nt=new google.maps.Geocoder;$("#map").length>0&&ii();$("#pse-search-txt").keyup(function(n){n.keyCode==13&&$("#MAPSearchBtn").click()});document.getElementById("MAPSearchBtn").addEventListener("click",function(){fi(nt,r)})}.bind(window));$(document).on("click",".legend",function(){$(this).hasClass("collapsed")?($(this).parent().find(".less").hide(),$(this).parent().find(".more").show(),$(this).parent().find(".fa-chevron-up").removeClass("fa-chevron-up").addClass("fa-chevron-down")):($(this).parent().find(".more").hide(),$(this).parent().find(".less").show(),$(this).parent().find(".fa-chevron-down").removeClass("fa-chevron-down").addClass("fa-chevron-up"))});$(".list-view-icon").on("click",function(){$(".map-view,.map-button-view").css("display","block");$(".list-view").css("display","none");$(".list-content").css("display","block");$("#map").css("display","none")});$(".map-change-icon").on("click",function(){$(".map-view,.map-button-view").css("display","none");$(".list-view").css("display","block");$("#map").css("display","block");$(".list-content").css("display","none")});$(window).width()<=767&&(mapViewFlag==0?($(".btn-map, .list-content").show(),$("#map, .btn-list").hide()):($(".btn-map, .list-content").hide(),$("#map, .btn-list").show()));$(".btn-map").on("click",function(){$(".btn-map, .list-content").hide();$("#map, .btn-list").show();mapViewFlag=1});$(".btn-list").on("click",function(){$(".btn-map, .list-content").show();$("#map, .btn-list").hide();mapViewFlag=0});$.validator.addMethod("mail",function(n,t){return this.optional(t)||/(^[-!#$%&'*+/=?^_`{}|~0-9A-Z]+(\.[-!#$%&'*+/=?^_`{}|~0-9A-Z]+)*|^"([\001-\010\013\014\016-\037!#-\[\]-\177]|\\[\001-\011\013\014\016-\177])*")@((?:[A-Z0-9](?:[A-Z0-9-]{0,61}[A-Z0-9])?\.)+(?:[A-Z]{2,6}\.?|[A-Z0-9-]{2,}\.?)$)|\[(25[0-5]|2[0-4]\d|[0-1]?\d?\d)(\.(25[0-5]|2[0-4]\d|[0-1]?\d?\d)){3}\]$/i.test(n)},NotifyMeValidation.validEmailid);captcha_validation={captchaFormNotArobot:"Check this field"};$.validator.addMethod("phoneUSA",function(n,t){return n=n.replace(/\s+/g,""),this.optional(t)||n.length>9&&n.match(/^(\+?1-?)?(\([0-9]\d{2}\)|[0-9]\d{2})-?[0-9]\d{2}-?\d{4}$/)},NotifyMeValidation.validphoneno);$("#interactiveMapNotify").validate({ignore:".ignore",hiddenRecaptcha:{required:!0},messages:{hiddenRecaptcha:{required:captcha_validation.captchaFormNotArobot}},errorPlacement:function(n,t){n.appendTo(t.parent(".errorDiv").next(".errorMessage"))}});$("#interative-map-email-address").rules("add",{mail:!0,messages:{required:NotifyMeValidation.verifiedaddressemail}});$("#interative-map-phone-number").rules("add",{phoneUSA:!0,messages:{required:NotifyMeValidation.verifiedmobileno}});$(document).ready(function(){var n=getQueryStringForSearch("q");n==null||typeof n=="undefined"||n==""||($("#pse-search-txt").val(n),$("#MAPSearchBtn").click());btnDisable();$("#interative-map-phone-number").inputmask({mask:"(999) 999-9999"}),function(){var n=navigator.userAgent,t,i=/iPad|iPhone|iPod/.test(n),r=/OS 11_0|OS 11_1|OS 11_2/.test(n);if(i&&r){$(document.body).on("show.bs.modal",function(n){$(n.target).hasClass("map-notification-modal")&&(t=$(document).scrollTop(),$("body").addClass("iosBugFixCaret"))});$(document.body).on("hide.bs.modal",function(n){$(n.target).hasClass("notification-modal")&&($("body").removeClass("iosBugFixCaret"),$(document).scrollTop(t))})}}()});$(document).on("keyup","#interactiveMapNotify input",function(){_emailTxt=$("#interative-map-email-address").val();_phnTxt=$("#interative-map-phone-number").val();_isNotEmpty=_emailTxt||_phnTxt;_isEitherOneValid=_emailTxt!=""&&$("#interative-map-email-address").valid()||_phnTxt!==""&&$("#interative-map-phone-number").valid();_disableBtn=_isNotEmpty?_isEitherOneValid?!1:!0:!0;$(".interactive-notify-button").prop("disabled",_disableBtn)});$("#btnNotify").click(function(n){if($("#interactiveMapNotify input").valid())n.preventDefault(),typeof grecaptcha!="undefined"?validateCaptcha(outageMapCallBack):submitOutageNotify();else return!1});$(document).on("blur","#interactiveMapNotify input",function(){$(this).val()==""?$(this).siblings().removeClass("is-text"):$(this).siblings().addClass("is-text")});