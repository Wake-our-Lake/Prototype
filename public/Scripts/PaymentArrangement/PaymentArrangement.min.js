function isNumber(n,t){var r=t.value,i;return(n=n?n:window.event,i=n.which?n.which:n.keyCode,i==46)?!0:i>31&&(i<48||i>57)?!1:!0}function GetVisiblePaymentAmounts(){var t,n;for(paymentAmounts=new PaymentAmounts,t=$(".data-payment-amountcheck:visible"),n=0;n<t.length;n++)paymentAmounts.add(t[n])}function PaymentAmount(n){this.data=n;this.installmentNumber=0;this.previous=null;this.next=null}function PaymentAmounts(){this._length=0;this.first=null;this.last=null}function ActivateFormItemsAndEvents(){GetVisiblePaymentAmounts();GetVisiblePaymentDates();$(".data-payment-amountcheck").focus(function(){currentPaymentValue=$(this).val();totalPayment=totalPaymentAmount}).focusout(function(){var t,n;if(newPaymentValue=$(this).val(),newPaymentValue==""||isNaN(newPaymentValue)){$(this).val(currentPaymentValue);return}if(newPaymentValue.indexOf(".")!==-1){var u=newPaymentValue.indexOf("."),f=newPaymentValue.length,e=f+1-u;e>3&&(newPaymentValue=Number(newPaymentValue).toFixed(2),$(this).val(newPaymentValue))}if(currentPaymentValue!=newPaymentValue){if($(this).parents(".payoption-first").length&&newPaymentValue<totalPayment/2&&(n=$(this).parents().siblings("[data-alert-paymentmessage]").find("p"),$(n).addClass("error-payment").text(firstPaymentValidation+" "+(totalPayment/2).toFixed(2)),setTimeout(function(){$(n).removeClass("error-payment")},2e3),$(this).val((totalPayment/2).toFixed(2))),t=GetPaymentElementOf($(this)),Number(SumOfParentPaymentElements(t))+Number(newPaymentValue)>totalPayment){$(this).val(currentPaymentValue);n=$(t.data).parents().siblings("[data-alert-paymentmessage]").find("p");$(n).addClass("error-payment").text(totalAmountValidation+" "+totalPayment);setTimeout(function(){$(n).removeClass("error-payment")},2e3);return}if($(this).parents(".payoption-final").length){var i=paymentAmounts.last.previous,n=$(i.data).parents().siblings("[data-alert-paymentmessage]").find("p"),r=totalPayment-SumOfParentPaymentElements(i)-parseFloat(Number($(this).val()).toFixed(2));i.data.value=r.toFixed(2);$(n).addClass("error-payment").text(flexiblePaymentValidation+" "+r.toFixed(2));setTimeout(function(){$(n).removeClass("error-payment")},2e3)}else UpdateSubsequentPayments(t)}});$(".payment-arrangement-option").change(function(){locale="en-us";daysname=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];var n=GetPaymentDateElementOf($(this));UpdateSubsequentDates(n);UpdatePreviousDate(n)})}function GetPaymentElementOf(n){for(var t=paymentAmounts.first;t!=null;){if(t.data===n[0])break;t=t.next}return t}function SumOfParentPaymentElements(n){for(var t=0,i=n.previous;i!=null;)t=Number(t)+parseFloat(Number(i.data.value).toFixed(2)),t=t.toFixed(2),i=i.previous;return t}function UpdateSubsequentPayments(n){for(var t=n.next,r;t!=null;){r=(totalPayment-SumOfParentPaymentElements(t))/(paymentAmounts._length-t.installmentNumber+1);t.data.value=r.toFixed(2);var i=$(t.data).parents().siblings("[data-alert-paymentmessage]").find("p"),f=i[0].id,e=i[1].id,u=flexiblePaymentValidation;t.installmentNumber==paymentAmounts._length&&(u=finalPaymentValidation);$(i).addClass("error-payment").text(u+" "+t.data.value);SetTimeoutFade(f);SetTimeoutFade(e);t=t.next}}function SetTimeoutFade(n){setTimeout(function(){$("#"+n).removeClass("error-payment")},2e3)}function SumOfAllPaymentAmount(){for(var t=paymentAmounts.first,n=0;t!=null;)n=Number(n)+parseFloat(Number(t.data.value).toFixed(2)),n=n.toFixed(2),t=t.next;return n}function PaymentDate(n){this.data=n;this.installmentNumber=0;this.previous=null;this.next=null}function PaymentDates(){this._length=0;this.first=null;this.last=null}function UpdatePreviousDate(n){var r;if(n.previous!=null&&(n.previous.installmentNumber!=1||!(new Date(n.data.value)>firstPaymentLastEndDate)||new Date(n.previous.data.lastElementChild.value)!=firstPaymentLastEndDate)){var t=n.previous,u=$(t.data).children("option:selected").val(),f=new Date($(t.data).children("option")[0].value),i=new Date(firstPaymentLastEndDate);i.setDate(i.getDate()+1);r=n.previous.installmentNumber==1&&new Date(n.data.value)>firstPaymentLastEndDate?i:new Date(n.data.value);$(t.data).empty();AddDates(t,f,r);RetainSelection(t,u)}}function AddDates(n,t,i){var e=i.getTime()-t.getTime(),u=Math.ceil(e/864e5),r;for(u<=0&&(u=1),dayCount=0;dayCount<u;dayCount++){r=new Date(t);r.setDate(t.getDate()+dayCount);var o=daysname[r.getDay()],f=r.getDate(),s=r.toLocaleString(locale,{month:"short"}),h=r.getMonth()+1,c=r.getFullYear(),l=o+", "+s+" "+f,a=h+"/"+f+"/"+c+" 12:00:00 AM";$(n.data).append($("<option><\/option>").attr("value",a).text(l))}}function UpdateSubsequentDates(n){var t=n.next,u,i,r;t!=null&&(u=$(t.data).children("option:selected").val(),$(t.data).empty(),i=new Date(t.previous.data.value),i.setDate(i.getDate()+1),r=GetEndDate(t),AddDates(t,i,r),i>r&&UpdateSubsequentDates(t),RetainSelection(t,u))}function RetainSelection(n,t){$(n.data).children("option").each(function(){$(this).val()==t&&$(this).parent("select").val($(this).val())})}function GetEndDate(n){return n.next!=null?new Date(n.next.data.value):overallDueDate}function GetVisiblePaymentDates(){var n,t;if(paymentDates=new PaymentDates,n=$("select:visible"),typeof n!="undefined"&&n.length!=0)for(firstPaymentLastEndDate=new Date($("select:visible")[0].lastElementChild.value),t=0;t<n.length;t++)paymentDates.add(n[t])}function GetPaymentDateElementOf(n){for(var t=paymentDates.first;t!=null;){if(t.data===n[0])break;t=t.next}return t}$(document).ready(function(){typeof $(".OverallPaymentDueDate")!="undefined"&&$(".OverallPaymentDueDate").length!=0&&(overallDueDate=new Date($(".OverallPaymentDueDate").val()));ActivateFormItemsAndEvents()});PaymentAmounts.prototype.add=function(n){var t=new PaymentAmount(n);return t.installmentNumber=this._length+1,this._length?(this.last.next=t,t.previous=this.last,this.last=t):(this.first=t,this.last=t),this._length++,t};$("input[name='payoption']").on("change",function(){if(isAjaxReturn){$("#pasubmit").prop("disabled",!0);$("input[type=radio]").attr("disabled",!0);var n=$(this).val();isAjaxReturn=!1;$.ajax({url:"/api/sitecore/PaymentArrangement/PAEligibleForm?installmentType="+n,type:"POST"}).always(function(n){$("#payment-options").html(n);$("#pasubmit").prop("disabled",!1);$("input[type=radio]").attr("disabled",!1);isAjaxReturn=!0;ActivateFormItemsAndEvents()})}});$("#pasubmit").click(function(){$("form[name='payment-options']").submit()});PaymentDates.prototype.add=function(n){var t=new PaymentDate(n),i;return t.installmentNumber=this._length+1,this._length?(this.last.next=t,t.previous=this.last,this.last=t):(this.first=t,this.last=t),this._length++,i=new Date(t.data.value),i>overallDueDate&&(overallDueDate=i,overallDueDate.setDate(overallDueDate.getDate()+1)),t};